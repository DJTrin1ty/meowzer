<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Meow Single</title>
    <style>
      { padding: 0; margin: 0 }
      canvas { background: #eee; display: block; margin: 0 auto; }
    </style>
  </head>
  <body>

    <canvas id="myCanvas" width="1000" height="500"></canvas>

    <script>
      let canvas = document.getElementById("myCanvas");
      // grab our canvas to save
      let ctx = canvas.getContext("2d");
      // call and hold our canvas tool render-er

      //sets starting location for ball
      let scrollImg = new Image();
      let imgWidth = 0;
      let imgHeight = 0;
      let imageData = {};
      let canvasWidth = 1000;
      let canvasHeight = 500;
      let scrollVal = 0;
      let speed = 2;
      scrollImg.src = "http://res.cloudinary.com/josephgupkim/image/upload/c_scale,w_1000/v1468458751/6-vector-game-backgrounds-8003_imgs_8003_2_r5sezh.png";
      scrollImg.onload = loadImage;

      function loadImage(){
        imgWidth = scrollImg.width,
        imgHeight = scrollImg.height;
        canvas.width = 1000;
        canvas.height = 500;
        renderMain();
      }

      let birdyImg = new Image();
      birdyImg.src = "http://res.cloudinary.com/josephgupkim/image/upload/v1468459980/birdyfinal_qa3jol.png"

      let kittyImg = new Image();
      kittyImg.src = "http://res.cloudinary.com/josephgupkim/image/upload/v1468473589/fatcatfinal_ri9nay.png";

      let birdy2Img = new Image();
      birdy2Img.src = "http://res.cloudinary.com/josephgupkim/image/upload/v1468474814/143902_flappy-flying-bird-sprite-shee_fukbcl.png";


      let kittyRadius = 25
      let kittyStartX = 100;
      let kittyStartY = canvas.height - kittyRadius;

      let frameNum = 0;
      let fNum = 0;
      let b2Num = 0;

      const fastBird = {
        fbr: 15,
        fbsx: canvas.width - 90,
        fbsy: 200,
        fbvx: -4,
        fbvy: 0,
        color: "blue"
      }

      const slowBird = {
        fbr: 30,
        fbsx: canvas.width - 90,
        fbsy: 100,
        fbvx: -3,
        fbvy: 0,
        color: "green"
      }

      function renderMain(bird1, bird2){

        if (frameNum < 3){
          frameNum += 1;
        } else {
          frameNum = 0;
        }
        if (fNum < 4){
          fNum += 1;
        } else {
          fNum = 0;
        }
        if (b2Num < 8){
          b2Num += 1;
        } else {
          b2Num = 0;
        }
        if (scrollVal >= canvasWidth){
          scrollVal = 0;
        }

        scrollVal += speed;
        ctx.drawImage(scrollImg,-scrollVal,0,imgWidth, imgHeight);
        ctx.drawImage(scrollImg,canvasWidth-scrollVal,0,imgWidth, imgHeight);

        ctx.drawImage(birdyImg,
          0 + (frameNum * 92),
          0,
          92,
          64,
          (bird1.fbsx - bird1.fbr),
          (bird1.fbsy - bird1.fbr),
          bird1.fbr * 2,
          bird1.fbr * 2
        )

        ctx.drawImage(birdy2Img,
          0 + (b2Num * 65),
          0,
          60,
          46,
          (bird2.fbsx - bird2.fbr),
          (bird2.fbsy - bird2.fbr),
          5 + (bird2.fbr * 2),
          5 + (bird2.fbr * 2)
        )

        ctx.drawImage(kittyImg,
          0 + (fNum * 50),
          0,
          50,
          50,
          (kittyStartX - kittyRadius),
          (kittyStartY - kittyRadius),
          kittyRadius * 2,
          kittyRadius * 2
        )
      }

      let birdsCaught = 0;

      function drawBird(bird){
        ctx.beginPath();
        ctx.arc(bird.fbsx, bird.fbsy, bird.fbr, 0, Math.PI * 2, false);
        ctx.fillStyle = "blue";
        ctx.fill();
        ctx.closePath();
      }


      //BOOOOOOOOOOOOOOOOOOOOOOOOWETIHOWEIHTOIWHETPOWHETPOHJWET


      function drawKitty(){
        ctx.beginPath();
        ctx.arc(kittyStartX, kittyStartY, kittyRadius, 0, Math.PI * 2, false);
        ctx.fillStyle = 'red';
        ctx.fill();
        ctx.closePath();
      }

      let tempY = randomStarter();


      let upPressed = false;
      let downPressed = false;

      function randomStarter(){
        return (Math.random() * (canvas.height - 30));
      }

      function reDraw(){
        drawBird(fastBird);
        drawBird(slowBird);
        drawKitty();
      }

      function checkBounds(bird){
        if (bird.fbsx + bird.fbr < 0){
          bird.fbsx = canvas.width - 30;
          birdsCaught += 1;
          bird.fbsy = randomStarter();
        }
        if (upPressed && kittyStartY - kittyRadius > 0){
          kittyStartY *= .99;
          kittyStartY -= 1;
        } else if (kittyStartY < (canvas.height - kittyRadius)){
          kittyStartY += 3;
        }
      }

      function turnUp(x, y){
        fastBird.fbvx = -x;
        slowBird.fbvx = -y;
      }

      //-4, -3
      function levelUp(){
        if (birdsCaught === 10){
          turnUp(6, 4);
        } else if (birdsCaught === 20){
          turnUp(9, 7);
        } else if (birdsCaught === 40){
          turnUp(11, 9);
        } else if (birdsCaught === 60){
          turnUp(13, 13);
        } else if (birdsCaught === 80){
          turnUp(1, 1);
        }
      }

      function collisionOccured(bird){
        let dist = Math.sqrt(Math.pow(bird.fbsx - kittyStartX, 2) + Math.pow(bird.fbsy - kittyStartY, 2))
        return dist < (bird.fbr + kittyRadius);
      }


      function moveImage(bird){
        bird.fbsx += bird.fbvx;
        bird.fbsy += bird.fbvy;
      }

      function gameOver(bird1, bird2){
        if (collisionOccured(bird1)){
          console.log(`GG fastBird ${birdsCaught} birds caught!`);
        } else if (collisionOccured(bird2)){
          console.log(`GG slowBird ${birdsCaught} birds caught!`);
        }
      }

      function mechanic(){
        moveImage(fastBird);
        moveImage(slowBird);
        reDraw();
        renderMain(slowBird, fastBird);
        // birdyRender(slowBird, fastBird);
        gameOver(fastBird, slowBird);
        // levelUp();
        checkBounds(fastBird);
        checkBounds(slowBird);
        console.log(birdsCaught);
      }

      //listen for key "downs/ups" and use functions "keyDownHandler",
      //keyUpHandler.
      document.addEventListener("keydown", keyDownHandler, false);
      document.addEventListener("keyup", keyUpHandler, false);
//Util
      //if "up" arrow key is pressed set var to "true"
      function keyDownHandler(e){
        if (e.keyCode === 32){
          upPressed = true;
        }
      }
      //if "up" arrow key is released set var to "false"
      function keyUpHandler(e){
        if (e.keyCode === 32){
          upPressed = false;
        }
      }


      //draw
      setInterval(mechanic, 10);


    </script>


  </body>
</html>
