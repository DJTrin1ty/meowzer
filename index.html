<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Meow Single</title>
    <style>
      { padding: 0; margin: 0 }
      canvas { background: #eee; display: block; margin: 0 auto; }
    </style>
  </head>
  <body>

    <canvas id="myCanvas" width="1000" height="500"></canvas>

    <script>
      let canvas = document.getElementById("myCanvas");
      // grab our canvas to save
      let ctx = canvas.getContext("2d");
      // call and hold our canvas tool render-er

      //sets starting location for ball
      let scrollImg = new Image();
      let imgWidth = 0;
      let imgHeight = 0;
      let imageData = {};
      let canvasWidth = 1000;
      let canvasHeight = 500;
      let scrollVal = 0;
      let speed = 2;
      scrollImg.src = "http://res.cloudinary.com/josephgupkim/image/upload/c_scale,w_1000/v1468458751/6-vector-game-backgrounds-8003_imgs_8003_2_r5sezh.png";
      scrollImg.onload = loadImage;


      function loadImage(){
        imgWidth = scrollImg.width,
        imgHeight = scrollImg.height;
        canvas.width = 1000;
        canvas.height = 500;
        // render();
      }

      function render(){
        // ctx.clearRect(0, 0, canvasWidth, canvasHeight);

        if (scrollVal >= canvasWidth){
          scrollVal = 0;
        }

        scrollVal += speed;
        ctx.drawImage(scrollImg,-scrollVal,0,imgWidth, imgHeight);
        ctx.drawImage(scrollImg,canvasWidth-scrollVal,0,imgWidth, imgHeight);
      }

      let birdyImg = new Image();
      birdyImg.src = "http://res.cloudinary.com/josephgupkim/image/upload/v1468459980/birdyfinal_qa3jol.png"


      let kittyImg = new Image();
      kittyImg.src = "http://res.cloudinary.com/josephgupkim/image/upload/v1468473589/fatcatfinal_ri9nay.png";


      let birdy2Img = new Image();
      birdy2Img.src = "http://res.cloudinary.com/josephgupkim/image/upload/v1468474814/143902_flappy-flying-bird-sprite-shee_fukbcl.png";


      let kittyRadius = 25
      let kittyStartX = 100;
      let kittyStartY = canvas.height - (kittyRadius * 3);

      let frameNum = 0;
      let b2Num = 0;
      let fNum = 0;
      function birdyRender(bird, bird2){

        if (frameNum < 3){
          frameNum += 1;
        } else {
          frameNum = 0;
        }

        if (b2Num < 8){
          b2Num += 1;
        } else {
          b2Num = 0;
        }

        if (fNum < 4){
          fNum += 1;
        } else {
          fNum = 0;
        }


        ctx.drawImage(birdyImg,
          0 + (frameNum * 92),
          0,
          92,
          64,
          (bird.fbsx - 30),
          (bird.fbsy - 30),
          60,
          60
        )

        ctx.drawImage(birdy2Img,
          0 + (b2Num * 65),
          0,
          60,
          46,
          (bird2.fbsx - 15),
          (bird2.fbsy - 25),
          45,
          55
        )

        ctx.drawImage(kittyImg,
          0 + (fNum * 50),
          0,
          50,
          50,
          56,
          (kittyStartY - 40),
          75,
          75
        )
      }


      let highscoreCounter = 0;


      const fastBird = {
        fbr: 15,
        fbsx: canvas.width - 90,
        fbsy: 200,
        fbvx: -4,
        fbvy: 0,
        color: "blue"
      }

      const slowBird = {
        fbr: 30,
        fbsx: canvas.width - 90,
        fbsy: 100,
        fbvx: -3,
        fbvy: 0,
        color: "green"
      }

      function drawBird(bird){
        ctx.beginPath();
        ctx.arc(bird.fbsx, bird.fbsy, bird.fbr, 0, Math.PI * 2, false);
        ctx.fillStyle = "blue";
        ctx.fill();
        ctx.closePath();
      }

      function drawKitty(){
        ctx.beginPath();
        ctx.arc(kittyStartX, kittyStartY, kittyRadius, 0, Math.PI * 2, false);
        ctx.fillStyle = 'red';
        ctx.fill();
        ctx.closePath();
      }

      let upPressed = false;
      let starting = true;

      function reDraw(){
        drawBird(fastBird);
        drawBird(slowBird);
        drawKitty();
      }


      function randomStarter(){
        return (Math.random() * (canvas.height - 50));
      }

      function checkBounds(bird){
        if (bird.fbsx + bird.fbr < 0){
          bird.fbsx = canvas.width - 30;
          highscoreCounter += 1;
          bird.fbsy = randomStarter();
        }
        if (upPressed && kittyStartY - kittyRadius > 0){
          kittyStartY *= .99;
          kittyStartY -= 1;
        } else if (kittyStartY - kittyRadius - 30 > canvas.height){
          gameOver();
        } else {
          if (starting){
            kittyStartY += 0;
          } else {
            kittyStartY += 3;
          }
        }
      }



      function turnUp(x, y){
        fastBird.fbvx = -x;
        slowBird.fbvx = -y;
      }

      //-4, -3
      function levelUp(){
        if (highscoreCounter === 10){
          fastBird.fbvx = -6;
          slowBird.fbvx = -4;
        } else if (highscoreCounter === 20){
          fastBird.fbvx = -9;
          slowBird.fbvx = -7;
        } else if (highscoreCounter === 40){
          fastBird.fbvx = -11;
          slowBird.fbvx = -9;
        } else if (highscoreCounter === 60){
          fastBird.fbvx = -13;
          slowBird.fbvx = -13;
        } else if (highscoreCounter === 80){
          fastBird.fbvx = -15;
          slowBird.fbvx = -15;
        }
      }

      function collisionOccured(bird){
        let dist = Math.sqrt(Math.pow(bird.fbsx - kittyStartX, 2) + Math.pow(bird.fbsy - kittyStartY, 2))
        return dist < (bird.fbr + kittyRadius);
      }

      function moveImage(bird){
        bird.fbsx += bird.fbvx;
        bird.fbsy += bird.fbvy;
      }

      function birdReset(){
        fastBird.fbsx = canvasWidth - 90;
        fastBird.fbsy = 200;
        fastBird.fbvx = 0;
        slowBird.fbsx = canvasWidth - 90;
        slowBird.fbsy = 100;
        slowBird.fbvx = 0;
        speed = 0;
      }

      function checkIfGameOver(bird1, bird2){
        if (collisionOccured(bird1)){
          gameOver();
        } else if (collisionOccured(bird2)){
          gameOver();
        }
      }

      function gameOver(){
        alert(`Game Over! Your score was ${highscoreCounter}!`);
        birdReset();
      }

      function mechanic(){
        render();
        // reDraw();
        moveImage(fastBird);
        moveImage(slowBird);

        birdyRender(slowBird, fastBird);

        checkIfGameOver(fastBird, slowBird);
        levelUp();
        checkBounds(fastBird);
        checkBounds(slowBird);
      }


      document.addEventListener("keydown", keyDownHandler, false);
      document.addEventListener("keyup", keyUpHandler, false);

      function keyDownHandler(e){
        if (e.keyCode === 32){
          upPressed = true;
          starting = false;
        }
      }

      function keyUpHandler(e){
        if (e.keyCode === 32){
          upPressed = false;
        }
      }

      // setInterval(mechanic, 10);
      setTimeout(function(){ setInterval(mechanic, 10)}, 3000);

    </script>

    <h3>Meowzer</h3>
    <p> Press and hold down the "space bar" to make Meowzer fly upwards.
      Releasing the "space bar" will bring him back down towards the ground.
      Dodge the mean birds and attempt to gain the highest score. But
      be warned, it gets harder over time!</p>
  </body>
</html>
